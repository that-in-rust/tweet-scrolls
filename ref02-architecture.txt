# Tweet-Scrolls Architecture Document
**Status: PRODUCTION-READY TDD IMPLEMENTATION**

## 🎉 **ARCHITECTURAL EXCELLENCE ACHIEVED**
- **Complete Modular Architecture**: All files under 600-line limit
- **TDD-Driven Design**: Every module developed with Red→Green→Refactor
- **Idiomatic Rust**: Following all Rust best practices and conventions
- **Production-Ready**: Comprehensive error handling and async I/O

## 📊 **Module Architecture Overview**
```
src/
├── main_integration.rs (47 lines)      # Main function integration
├── lib.rs (14 lines)                   # Module exports
├── processing/                         # Data processing modules
│   ├── mod.rs (19 lines)              # Module organization
│   ├── data_structures.rs (158 lines)  # Core data types
│   ├── file_io.rs (234 lines)         # File I/O operations
│   ├── tweets.rs (287 lines)          # Tweet processing
│   └── direct_messages.rs (412 lines) # DM processing
├── relationship/                       # Relationship analysis
│   ├── mod.rs (14 lines)              # Module organization
│   ├── anonymization.rs (134 lines)   # Blake3 user hashing
│   ├── communication.rs (298 lines)   # Communication analysis
│   ├── analyzer.rs (456 lines)        # Core relationship logic
│   ├── timeline_integration.rs (398)  # Timeline analysis
│   └── file_generation.rs (395 lines) # LLM file generation
├── models/                            # Data models (preserved)
├── services/                          # Timeline services (preserved)
└── utils/                            # Utility functions (preserved)
```

## 🔄 **Complete Data Flow Architecture**

Data Flow in Modular Architecture:

Input/Output Flow:
┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│ tweets.js   │ ──► │ Tweet-Scrolls│ ──► │Tweet Output │
└─────────────┘     └──────────────┘     └─────────────┘
┌─────────────┐            │              ┌─────────────┐
│direct-msg.js│ ──────────►│              │ DM Output   │
│ (optional)  │            │              │ (optional)  │
└─────────────┘            └─────────────►└─────────────┘

Main Processing Pipeline:
┌─────────────┐
│   main()    │ ─┐
└─────────────┘  │
                 ▼
┌──────────────────────┐     ┌─────────────────────┐
│ get_input_file()     │ ◄── │ get_screen_name()   │
└──────────────────────┘     └─────────────────────┘
          │                           │
          ▼
┌──────────────────────┐     ┌─────────────────────┐
│  Timeline Analysis   │     │  User Profiling     │
│  - Active hours      │     │  - DM Stats        │
│  - Weekly patterns   │     │  - Tweet Stats     │
│  - Burst detection   │     │  - Engagement      │
└──────────────────────┘     └─────────────────────┘
          │                           │
          ▼                           ▼
┌──────────────────────┐     ┌─────────────────────┐
│  process_tweets()    │     │   get_dm_file()     │
└──────────────────────┘     │    (optional)       │
          │                  └─────────────────────┘
          ├─────────────────┐          │
          ▼                 ▼          ▼
┌──────────────┐    ┌─────────────┐   ┌──────────────────┐
│write_threads_│    │  write_csv  │   │ process_dm_file()│
│  to_file()   │    │    ()       │   │   (optional)     │
└──────────────┘    └─────────────┘   └──────────────────┘
                                              │
                                              ├─────────────────┐
                                              ▼                 ▼
                                      ┌──────────────┐  ┌─────────────┐
                                      │ DM CSV/TXT   │  │ DM Results  │
                                      │   Output     │  │   Summary   │
                                      └──────────────┘  └─────────────┘

Data Structures:
Tweet Processing:
Tweet ──► TweetWrapper
  │
  └──► Thread
        │
        └──► Vec<Tweet>

DM Processing (NEW):
DmMessage ──► DmConversation ──► DmWrapper
    │              │
    └──► DmMessageCreate    └──► ProcessedConversation
                                      │
                                      └──► Vec<ProcessedConversation>

Async Channel Flow:
Tweet Processing:
┌─────────────┐    ┌───────────┐    ┌─────────────┐
│ CSV Sender  │──► │Channel TX │──► │ CSV Writer  │
└─────────────┘    └───────────┘    └─────────────┘

DM Processing (NEW):
┌─────────────┐    ┌───────────┐    ┌─────────────┐
│ DM CSV Data │──► │Channel TX │──► │ DM CSV Writer│
└─────────────┘    └───────────┘    └─────────────┘

Memory Management:
🔒 Ownership flows down
📦 Borrows flow up
🚀 Async tasks run in parallel

Processing Details:

Tweet Processing Pipeline:
1. JSON Parsing: tweets.js → Vec<TweetWrapper>
2. Filtering: Remove retweets and invalid tweets
3. Threading: Group tweets by conversation chains
4. Sorting: Chronological order (newest first)
5. Output: CSV + TXT + Summary files

DM Processing Pipeline (NEW):
1. JSON Parsing: direct-messages.js → Vec<DmWrapper>
2. JavaScript Prefix Removal: Strip "window.YTD.direct_messages.part0 = "
3. Conversation Extraction: Extract message metadata
4. Filtering: Remove empty conversations (0 messages)
5. Sorting: By message count (descending)
6. Output: DM CSV + TXT + Summary files

## Timeline Analysis Architecture

### Components
1. **TimelineAnalyzer**
   - Processes interaction events
   - Detects temporal patterns
   - Calculates response statistics
   - Identifies active periods

2. **Pattern Detection**
   - Active hours identification
   - Weekly pattern analysis
   - Bursty activity detection
   - Conversation intensity measurement

3. **Response Time Analysis**
   - Calculate response time statistics
   - Track response time trends
   - Identify optimal response windows

### Data Flow
1. Raw events → TimelineAnalyzer → Pattern detection → Statistics generation
2. Results integrated into user profiles and conversation analysis
3. Visualizations generated for temporal patterns

File Format Support:
- Input: Twitter JSON archive format
- Output: CSV, TXT, summary files, and timeline visualizations from Twitter exports
- Output: Standard CSV with headers, human-readable TXT, processing summaries
- Error Handling: Comprehensive with anyhow context propagation
- Performance: Async I/O with buffered writing and memory optimization

Technical Architecture:
- Single-file Rust binary (src/main.rs)
- Tokio async runtime for I/O operations
- Channel-based CSV writing for performance
- Memory-optimized with mimalloc allocator
- Test-driven development with comprehensive coverage
- Graceful error handling and optional feature degradation


